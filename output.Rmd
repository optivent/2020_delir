---
title: "Exploration Delir 2020"
author: "AI Georgevici"
date: "4/13/2020"
output: html_document
---

```{r setup and load the data, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(here)
knitr::opts_knit$set(root.dir = here("output"))

library(tidyverse)
library(Boruta)
library(furrr)

delir <- read_rds(path = here("input/data.rds"))
delirRF <- read_rds(path = here("input/delir.rds"))

```

## The histogram of random forest scaled importance for crosscategorical items and those from same category
```{r median of RF corr from all dataframes, make double pairs}

suppressWarnings(
delirRF <- read_rds(path = here("input/delir.rds")) %>% 
  map(~ .x %>% filter(target != "number", feature != "number")) %>% 
  reduce(bind_rows) %>% 
  mutate(
    pair = paste(pmin(target,feature), pmax(target,feature), sep = " ~ ")
  ) %>% 
  group_by(pair) %>%
    summarise(value_mean = mean(value)) %>% 
  ungroup() %>% 
  arrange(desc(value_mean)) %>% 
  separate(pair, c("nodeA", "nodeB"), sep = " ~ ", remove = TRUE) %>% 
  separate(nodeA, c("nodeA_first", "nodeA1_rest"), extra = "merge", remove = FALSE) %>% 
  separate(nodeB, c("nodeB_first", "nodeB_rest"), extra = "merge", remove = FALSE) %>% 
  mutate(startA = str_sub(nodeA, end = 3L), startB = str_sub(nodeB, end = 3L)) %>% 
  mutate(check1 = (nodeA_first == nodeB_first),
         check2 = (nodeA_first == nodeB_first),
         check3 = (startA == startB),
         check = pmax(check1, check2, check3),
         crosscateg = ifelse(check == 1, FALSE, TRUE)) %>% 
  transmute(crosscateg, nodeA, nodeB, value_mean = as.integer(value_mean))
)

delirRF %>% ggplot(aes(x = value_mean, colour = crosscateg)) + geom_density(alpha = 0.1) + theme_minimal() +  scale_x_continuous(minor_breaks = seq(0, 60, 1))

```


## An interactive table to search for secondary end-points

```{r}
library(DT)

delirRF %>% DT::datatable(filter = 'top',  
          options = list(searchHighlight = TRUE, pageLength = 25 ))

```

